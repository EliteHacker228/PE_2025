# Table Detector Service

Сервис для автоматического определения таблиц и коррекции поворота сканированных документов с использованием YOLO модели.


## Основные возможности

- Автоматическое определение угла поворота таблиц на изображениях
- Коррекция поворота изображения для выравнивания таблиц
- REST API интерфейс для интеграции с другими сервисами
- Асинхронная обработка файлов
- Автоматическая очистка временных файлов

## Структура проекта
```
backend/
├── app/ # Основное приложение
│ ├── init.py
│ ├── main.py # Точка входа FastAPI
│ ├── api/ # API эндпоинты
│ │ ├── init.py
│ │ └── endpoints.py # Роутеры API
│ ├── core/ # Ядро приложения
│ │ ├── init.py
│ │ └── config.py # Конфигурация
│ ├── services/ # Бизнес-логика
│ │ ├── init.py
│ │ └── detector.py # Логика обработки изображений
│ └── models/ # Модели данных
│ └── init.py
│
├── tests/ # Тесты
│ ├── init.py
│ ├── conftest.py # Конфигурация pytest
│ ├── test_detector.py # Тесты детектора
│ ├── test_main.py # Тесты API
│ └── test_load.py # Нагрузочные тесты
│
├── models/ # ML модели
│ └── k_fold_split_0.pt # Предобученная модель YOLO
│
├── images/ # Примеры изображений (опционально)
├── results/ # Результаты обработки
├── temp/ # Временные файлы
│
├── requirements.txt # Зависимости
└── README.md # Документация
```
## Технологический стек

**Backend:**
- **Python** 3.9+
- **FastAPI** - высокопроизводительный веб-фреймворк
- **YOLOv8** (Ultralytics) - модель детекции объектов
- **OpenCV** - обработка изображений
- **Pydantic** - валидация данных
- **Uvicorn** - ASGI-сервер

**Тестирование:**
- **Pytest** - фреймворк для тестирования
- **pytest-mock** - мокирование зависимостей
- **TestClient** (FastAPI) - тестирование API

## Сценарий использования

1. **Загрузка документа**:
   - Пользователь загружает сканированное изображение через API
   - Изображение может быть повернуто на произвольный угол

2. **Обработка на сервере**:
   - Система детектирует таблицы на изображении
   - Определяет угол поворота таблицы
   - Автоматически поворачивает изображение для выравнивания таблицы

3. **Получение результата**:
   - Пользователь получает обработанное изображение
   - Таблицы на выходном изображении выровнены по горизонтали


## Тесты

### Тестовая структура

```
tests/
├── test_detector.py # Юнит-тесты и интеграционные тесты обработки изображений
├── test_main.py # Тесты API эндпоинтов
└── test_load.py # Нагрузочное тестирование
```

### Типы тестов

#### 1. Модульные тесты детектора (`test_detector.py`)
- `test_get_angle_to_rotate`: Проверка корректности расчета угла поворота
- `test_rotate_image`: Проверка работы функции поворота изображения
- `test_no_tables_detected`: Тест обработки изображения без таблиц
- `test_invalid_image_file`: Тест обработки несуществующего файла
- `test_with_real_image`: Интеграционный тест с реалистичным изображением
- `test_process_image_file`: Мокированная проверка полного цикла обработки

#### 2. Нагрузочные тесты (`test_load.py`)
- `test_concurrent_processing`: Тестирует обработку 10 изображений в 5 потоках
                                Проверяет стабильность работы при нагрузке

#### 3. Тесты API (`test_main.py`)
- `test_upload_invalid_file`: Проверка обработки некорректного файла
- `test_image_processing_flow`: Проверка полного цикла работы API
- `test_response_format`: Проверка корректности формата ответа


### Запуск тестов

```bash
# Установите зависимости
pip install -r requirements.txt

# Запустите все тесты
pytest tests/ -v

# Только тесты обработки изображений
pytest tests/test_detector.py -v

# Только нагрузочные тесты
pytest tests/test_load.py -v

# Только API тесты
pytest tests/test_main.py -v
